from src.masks import get_mask_account, get_mask_card_number


def mask_account_card(card_string: str) -> str:
    """Функция из строки с типом и номером, маскирует номер карты или счета."""
    # Разбиваем исходную строку на две части, начиная с конца:
    # первая часть — название/тип ("Visa Platinum" или "Счет"),
    # вторая часть — сам номер (карты или счета).
    parts = card_string.rsplit(" ", 1)

    # Если после разбиения получилось не две части (например, нет пробела),
    # считаем строку некорректной и просто возвращаем её без изменений.
    if len(parts) != 2:
        # Некорректный формат
        return card_string

    # Распаковываем две части в переменные:
    # name — тип/название,
    # number — номер карты или счета.
    name, number = parts

    # Если в имени встречается слово "Счет",
    # считаем, что это банковский счет, а не карта.
    if "Счет" in name:
        # Для счета показываем только последние 4 цифры,
        # перед ними добавляем две звездочки.
        return name + " " + get_mask_account(int(number))  # Маскировка счета
    else:
        # Иначе считаем, что это карта.
        # Маскируем карту так, чтобы были видны первые 6 и последние 4 цифры.

        # Убираем пробелы из номера на случай, если они есть,
        # чтобы работать с "чистой" последовательностью цифр.
        clean_num = number.replace(" ", "")

        # Проверяем, что длина номера равна 16 цифрам (типичный номер карты).
        # Если не 16, считаем формат неожиданным и не трогаем строку.
        if len(clean_num) == 16:
            # Склеиваем название карты и замаскированный номер через пробел.
            return name + " " + get_mask_card_number(int(clean_num))

        # Если номер карты не 16-значный, возвращаем исходную строку как есть.
        return card_string


def get_date(date_str: str) -> str:
    """Принимает строку с датой и возвращает в таком формате '11.03.2024'."""
    # Отделяем часть с датой от части со временем по символу 'T'
    date_part = date_str.split("T")[0]
    # Разбиваем дату на год, месяц и день
    year, month, day = date_part.split("-")
    # Собираем строку в формате 'ДД.ММ.ГГГГ'
    return f"{day}.{month}.{year}"
